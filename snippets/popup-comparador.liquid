{% comment %}
  Popup para mostrar la comparación de productos
{% endcomment %}

<div id="popup-comparador-{{ product.id }}" class="popup-comparador t4s-mfp-hide">
  <div class="popup-comparador__content">
    <button type="button" class="popup-comparador__close" aria-label="{{ 'compare_popup.close' | t }}">&times;</button>
    <div class="popup-comparador__body">
      {% render 'after-before-2' %}
    </div>
  </div>
</div>

<style>
.popup-comparador {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 9999;
  display: none;
  align-items: center;
  justify-content: center;
}

.popup-comparador.active {
  display: flex;
}

.popup-comparador__content {
  background: white;
  padding: 20px;
  border-radius: 8px;
  position: relative;
  width: 90%;
  max-width: 800px;
}

.popup-comparador__close {
  position: absolute;
  right: 10px;
  top: 10px;
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  z-index: 10000;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #333;
}

.popup-comparador__body {
  width: 100%;
  aspect-ratio: 1;
  position: relative;
  overflow: hidden;
}

@media (max-width: 767px) {
  .popup-comparador__content {
    width: calc(100% - 30px);
    padding: 15px;
  }
}
</style>

<script>
// Escuchar clicks en elementos con data-popup-comparador
document.addEventListener('click', function(e) {
  const trigger = e.target.closest('[data-popup-comparador]');
  if (trigger) {
    e.preventDefault();
    const popupId = trigger.getAttribute('data-popup-id');
    const popup = document.getElementById(popupId);
    if (popup) {
      popup.classList.add('active');
      document.body.style.overflow = 'hidden';
      setTimeout(beforeAfter, 100);
    }
  }
});

// Cerrar con el botón
document.querySelectorAll('.popup-comparador__close').forEach(button => {
  button.addEventListener('click', function() {
    const popup = this.closest('.popup-comparador');
    if (popup) {
      popup.classList.remove('active');
      document.body.style.overflow = '';
    }
  });
});

// Cerrar al hacer clic fuera del contenido
document.querySelectorAll('.popup-comparador').forEach(popup => {
  popup.addEventListener('click', function(e) {
    if (e.target === this) {
      this.classList.remove('active');
      document.body.style.overflow = '';
    }
  });
});

// Prevenir que el popup se cierre al interactuar con el slider
document.querySelectorAll('.popup-comparador__body').forEach(body => {
  body.addEventListener('click', function(e) {
    e.stopPropagation();
  });
});
</script>
