{% if page.metafields.custom.cat_logo_pdf != blank %}
  {% assign pdf_url = page.metafields.custom.cat_logo_pdf | file_url %}
{% else %}
  {% assign pdf_url = "" %}
{% endif %}

<!-- 📌 Cargar DearFlip de Forma Segura -->
<link rel="stylesheet" href="https://dearflip.com/releases/dearflip.css">
<script defer id="dearflip-script" src="https://dearflip.com/releases/dearflip.js"></script>

<!-- 📌 Contenedor del FlipBook -->
<div id="flipbookContainer">
  {% if pdf_url != "" %}
    <div class="df3d" id="myFlipbook" source="{{ pdf_url }}"></div>
  {% else %}
    <p class="error-message">⚠ No se encontró ningún PDF. Verifica el metafield en Shopify.</p>
  {% endif %}
</div>

<!-- 📌 Script para Inicializar el FlipBook de Forma Correcta -->
<script>
function loadDearFlip() {
    if (typeof DFLIP === "undefined") {
        console.error("❌ DearFlip aún no se ha cargado. Reintentando...");
        setTimeout(loadDearFlip, 1000); // 🔥 Reintentar cada 1 segundo hasta que cargue
        return;
    }

    const flipbookElement = document.getElementById("myFlipbook");

    if (!flipbookElement || !flipbookElement.getAttribute("source")) {
        console.error("❌ No se encontró el contenedor del FlipBook o la URL del PDF.");
        return;
    }

    console.log("🚀 Inicializando DearFlip con PDF:", flipbookElement.getAttribute("source"));

    new DFLIP({
        source: flipbookElement.getAttribute("source"),
        webgl: true,  // Activar efecto 3D realista
        backgroundColor: "#ffffff",  // Fondo blanco
        controls: {
            zoomIn: true,
            zoomOut: true,
            fullScreen: true,
            download: true  // Activar botón de descarga
        }
    }, flipbookElement);
}

document.addEventListener("DOMContentLoaded", function () {
    setTimeout(loadDearFlip, 3000); // 🔥 Esperar 3 segundos para que Shopify cargue correctamente los scripts
});
</script>

<!-- 📌 Estilos para el FlipBook -->
<style>
/* 📌 Estilos para centrar el FlipBook */
#flipbookContainer {
  width: 100%;
  max-width: 800px;
  margin: auto;
  text-align: center;
}

/* 📌 Ajustar el tamaño del FlipBook */
.df3d {
  width: 100% !important;
  height: 600px !important;
}

/* 📌 Mensaje de error */
.error-message {
  color: red;
  font-weight: bold;
  text-align: center;
  margin-top: 20px;
}
</style>
